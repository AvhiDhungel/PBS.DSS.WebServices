@page "/Document/{DocumentType}"

<MudSessionErrorWrapper FetchAsync="LoadBase64String">
    <Content>
        <MudPDFViewer Base64String="@Base64String" />
    </Content>
</MudSessionErrorWrapper>

@code {
    [Parameter]
    public string DocumentType { get; set; } = string.Empty;

    private string Base64String { get; set; } = string.Empty;

    private async Task LoadBase64String()
    {
        Base64String = await GetBase64();

        if (Base64String.IsEmpty()) SharedStateService.AddError(Resources.UnableToLocateDocument);
    }

    private async Task<string> GetBase64()
    {
        if (DocumentType.IsNullOrWhitespace()) return string.Empty;
        if (!Enum.TryParse(DocumentType, out DocumentTypes docType)) return string.Empty;

        var busyDialog = await DialogService.ShowAsync<MudBusyDialog>("");

        await SharedStateService.GetFromSession();

        //Debug Code
        var doc = await httpClient.GetByteArrayAsync("samplepdf.pdf");

        if (SharedStateService.SharedState.WorkItemType == WorkItemTypes.None) return string.Empty;

        if (SharedStateService.SharedState.WorkItemType == WorkItemTypes.ServiceOrder)
        {
            
        }
        else if (SharedStateService.SharedState.WorkItemType == WorkItemTypes.Appointment)
        {

        }

        busyDialog.Close();

        return Convert.ToBase64String(doc);
    }
}
