@page "/Document/{DocumentType}"

<MudSessionErrorWrapper FetchAsync="LoadBase64String">
    <Content>
        <MudPDFViewer Base64String="@Base64String" />
    </Content>
</MudSessionErrorWrapper>

@code {
    [Parameter]
    public string DocumentType { get; set; } = string.Empty;

    private string Base64String { get; set; } = string.Empty;

    private async Task LoadBase64String()
    {
        Base64String = await GetBase64();

        if (Base64String.IsEmpty()) SharedStateService.AddError("Unable to location document");
    }

    private async Task<string> GetBase64()
    {
        if (DocumentType.IsNullOrWhitespace()) return string.Empty;
        if (!Enum.TryParse(DocumentType, out SharedModelTypes docType)) return string.Empty;

        var doc = SharedStateService.GetBase64Document(docType) ?? string.Empty;
        if (doc.HasValue()) return doc;

        await SharedStateService.GetFromSession();
        return SharedStateService.GetBase64Document(docType) ?? string.Empty;
    }
}
