@page "/Document/{DocumentType}"

<MudSessionErrorWrapper FetchAsync="LoadBase64String">
    <Content>
        <MudPDFViewer Base64String="@Base64String" />
    </Content>
</MudSessionErrorWrapper>

@code {
    [Parameter]
    public string DocumentType { get; set; } = string.Empty;

    private string Base64String { get; set; } = string.Empty;

    private async Task LoadBase64String()
    {
        Base64String = await GetBase64();

        if (Base64String.IsEmpty()) SharedStateService.AddError(Resources.UnableToLocateDocument);
    }

    private async Task<string> GetBase64()
    {
        if (DocumentType.IsNullOrWhitespace()) return string.Empty;
        if (!Enum.TryParse(DocumentType, out DocumentTypes docType)) return string.Empty;

        var busyDialog = await DialogService.ShowAsync<MudBusyDialog>("");

        await SharedStateService.GetFromSession();

        //Debug Code
        var doc = await httpClient.GetByteArrayAsync("samplepdf.pdf");
        busyDialog.Close(); 
        return Convert.ToBase64String(doc);

        if (SharedStateService.SharedState.WorkItemType == WorkItemTypes.None) return string.Empty;

        var docArgs = new ServiceOrderDocumentFetchArgs();
        docArgs.ServiceOrderRef = SharedStateService.SharedState.WorkItemRef;
        docArgs.SerialNumber = SharedStateService.SharedState.SerialNumber;
        docArgs.DocumentType = docType;

        var resp = await ControllerAPIService.FetchServiceOrderDocument(docArgs);

        busyDialog.Close();

        if (resp.HasError || resp.ResponseObject == null) return string.Empty;

        return Convert.ToBase64String(resp.ResponseObject.Content);
    }
}
